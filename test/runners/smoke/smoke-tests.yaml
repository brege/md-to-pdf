# Smoke test manifest - all CLI smoke tests
name: "Validate config command"
base_command: "md-to-pdf"
tags: [config, pure, cli, smoke]
scenarios:
  - description: "Global config (default)"
    args: "config"
    expect:
      contains: "pdf_viewer:"

  - description: "Global config (--pure)"
    args: "config --pure"
    expect:
      yaml_has_key: "pdf_viewer"

  - description: "Plugin config (default)"
    args: "config --plugin cv"
    expect:
      contains_all: ["handler_script:", "Plugin Base Path:"]

  - description: "Plugin config (--pure)"
    args: "config --plugin cv --pure"
    expect:
      yaml_has_key: "handler_script"

---
name: "Validate help commands"
base_command: "md-to-pdf"
tags: [cli, help, smoke]
discovery:
  type: "cli_commands"
  source: "src/cli/commands"
  exclude: ["$0", "plugin", "collection"]
scenarios:
  - description: "Help for {command}"
    args: "{command} --help"
    expect:
      executes: true

---
name: "Validate plugin list command"
base_command: "md-to-pdf"
tags: [cli, smoke, plugin, list]
scenarios:
  - description: "List plugins (default)"
    args: "plugin list"
    expect:
      contains: "usable by md-to-pdf"

  - description: "List enabled plugins"
    args: "plugin list --enabled"
    expect:
      contains: "Enabled plugins"

  - description: "List available plugins"
    args: "plugin list --available"
    expect:
      contains_any: ["Available CM-managed plugins", "No CM-managed plugins found"]
  - description: "List disabled plugins"
    args: "plugin list --disabled"
    expect:
      contains_any: ["Disabled (but available) CM-managed plugins", "No disabled (but available) CM-managed plugins found."]

  - description: "List plugins (--short)"
    args: "plugin list --short"
    expect:
      contains_any: ["Summary for all known plugins"]

---
name: "Validate collection list command"
base_command: "md-to-pdf"
tags: [cli, smoke, collection, list]
scenarios:
  - description: "List collection names (short)"
    args: "collection list names --short"
    expect:
      contains_any: ["Downloaded plugin collections", "No downloaded collections found"]

  - description: "List downloaded collections (default)"
    args: "collection list names"
    expect:
      contains_any: ["Downloaded plugin collections", "No downloaded collections found"]

  - description: "List available plugins from collections"
    args: "collection list available"
    expect:
      contains_any: ["Available plugins", "No available plugins found in any collection"]

  - description: "List enabled plugins from collections"
    args: "collection list enabled"
    expect:
      contains_any: ["Enabled plugins", "No enabled plugins found"]

  - description: "List all plugins (alias for available)"
    args: "collection list all"
    expect:
      contains_any: ["Available plugins", "No available plugins found in any collection"]

---
name: "Validate bundled plugins"
base_command: "md-to-pdf"
tags: [cli, smoke, plugin, bundled, validate]
discovery:
  type: "directory_scan"
  source: "plugins"
  filter: "directories"
scenarios:
  - description: "Validate plugin {item}"
    args: "plugin validate {item}"
    expect:
      executes: true

---
name: "Plugin List States (Full vs Empty)"
base_command: "md-to-pdf"
tags: [cli, smoke, plugin, list, enable, disable]
visual_focus: "empty state handling, table formatting consistency"
scenarios:
  - description: "Plugin list --available (likely empty) - empty state formatting"
    args: "plugin list --available"
    expect:
      executes: true
    visual_check: "Clean empty state with consistent theming and helpful messaging"

  - description: "Plugin list --disabled (likely empty) - empty state vs populated"
    args: "plugin list --disabled"
    expect:
      executes: true
    visual_check: "Empty state handling or populated list with proper disabled styling"

  - description: "Plugin list (populated) - full table formatting"
    args: "plugin list"
    expect:
      executes: true
    visual_check: "Rich populated table with headers, colors, and proper alignment"

---
name: "Collection List States (Full vs Empty)"
base_command: "md-to-pdf"
tags: [cli, smoke, collection, list, enable, disable, happy-path, sad-path]
visual_focus: "empty state consistency, messaging clarity"
scenarios:
  - description: "Collection list names (likely empty) - empty state"
    args: "collection list names"
    expect:
      executes: true
    visual_check: "Clean empty state messaging with consistent theming"

  - description: "Collection list available (empty) - no available plugins state"
    args: "collection list available"
    expect:
      executes: true
    visual_check: "Empty state for no available collection plugins"

  - description: "Collection list enabled (empty) - no enabled plugins state"
    args: "collection list enabled"
    expect:
      executes: true
    visual_check: "Empty state for no enabled collection plugins"

---
name: "Context Switching Empty States"
base_command: "md-to-pdf"
tags: [cli, smoke, coll-root, sad-path]
visual_focus: "error handling, context isolation, empty state consistency"
scenarios:
  - description: "Plugin list with non-existent collection root - context error handling"
    args: "plugin list --coll-root /tmp/nonexistent"
    expect:
      executes: true
    visual_check: "Graceful handling of missing collection root with clear messaging"

  - description: "Collection list with non-existent collection root - context isolation"
    args: "collection list names --coll-root /tmp/nonexistent"
    expect:
      executes: true
    visual_check: "Clean empty state when collection root doesn't exist"

