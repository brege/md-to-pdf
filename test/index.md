## Test Harness and QA Dashboard

This directory contains all assets related to testing the `md-to-pdf` application, including integration tests, end-to-end (E2E) tests, and the scripts that power this QA dashboard.

### Testing Framework

The project uses [Mocha](https://mochajs.org/) as its test runner. A centralized configuration file, `.mocharc.js`, is used to define test groups and paths, making the test suite highly flexible and easy to manage.

#### Running Tests

Tests can be executed from the command line with various flags to target specific groups, levels, or individual tests.

  * **Run all tests:**
    ```bash
    npm test
    ```
  * **Run a specific group** (defined in `.mocharc.js`):
    ```bash
    npm test -- --group level3
    ```
  * **Run a specific test file** by `grep`ping for its test ID:
    ```bash
    npm test -- --grep "3.5.1"
    ```
  * **Run a single test file** by path:
    ```bash
    npm test -- 'test/e2e/plugin-create.test.js'
    ```

### Telemetry -- Test Watcher

**[ [`test-watcher.js`](scripts/test-watcher.js) ]**

We also support a crude version of **telemetry**, which watches the `src/` for changes and then automatically runs the corresponding integration tests. -- **Experimental**

```bash
node test/scripts/test-watcher.js
```

### QA System Overview

The test status is not just manually tracked; it is dynamically generated by analyzing the state of the codebase and the test documentation itself.

**Source of Truth**

* `test/docs/checklist-level-?.md`: These files contain the master list of all planned test scenarios for each level of testing.
* `test/docs/audit-log.md`: This file documents known issues, limitations, or reasons why a test might be skipped.

**QA Scripts**

  * The scripts in `test/scripts/` are used to parse the checklists, the audit log, and the test files themselves (`*.test.js`).
  * They generate a consolidated report on any tests that are not in a "completed and passing" state.

## How to Update the Dashboard

To update the table below, run the following command from the **project root**:

```bash
node test/scripts/qa-dashboard.js --update-readme
```

**Checking for Holes in Test Coverage [beyond CI]**

These items are the kinds that *do not* get picked up by a CI. These tests are of three categories, and each category has its own script

1. [ [`find-nonclosed-audits.js`](scripts/find-nonclosed-audits.js) ]
   -- tests that are in the [audit log](docs/audit-log.md) and have not been marked as `CLOSED`
2. [ [`find-unchecked-tests.js`](scripts/find-unchecked-tests.js) ]
   -- tests that are unchecked in the [checklist](docs/checklist-level-%5B1-4%5D.md)
3. [ [`find-skipped-tests.js`](scripts/find-skipped-tests.js) ]
   -- tests that have been skipped via `it.skip()` in the `*.test.js` files

The **[ [`qa-dashboard.js`](scripts/qa-dashboard.js)** script synthesizes this information into a table at the end of this document.

**Random Utility Scripts**

- [ [`extract-test-blocks-string.js`](scripts/extract-test-blocks-string.js) ]
  -- a search utility to find modules by name within a test file:
  ``` bash
  node test/scripts/extract-test-blocks-string.js "default_handler" test/docs/checklist-level-2.md
  ```
- [ [`ls-matching-tests.js`](scripts/ls-matching-tests.js)
  -- a test file locator that finds all test blocks in a checklist, extracting their `test_id`:
  ``` bash
  node test/scripts/ls-matching-tests.js "ConfigResolver" test/docs/checklist-level-1.md
  ```

**Reporter and Logging of Failed Tests**

1. [ [`log-failures-reporter.js`](scripts/log-failures-reporter.js) ]
   -- a **reporter** that logs tests to a file, usually `~/.cache/md-to-pdf/logs/test-failures.json`
2. [ [`run-last-fails.js`](scripts/run-last-fails.js) ]
   -- parses the log `~/.cache/md-to-pdf/logs/test-failures.json` for failed tests, then execute only those that failed
   ```bash
   npm run test:last-fails
   ```

---

## Testing & Quality Assurance

*Documentation that details the project's testing framework, strategy, and metrics that define project quality.*

### Strategy & Process

* [Test Suite Index](../test/index.md):
  Main entry point for test-related documentation. Details the test harness and adjoins the dynamic QA dashboard.
* [Test Generation Priority Order](../test/docs/test-generation-priority-order.md):
  Explains the ranked, multi-level testing strategy and the priority for module test implementation.
* [Audit Log](../test/docs/audit-log.md):
  Logs known issues, limitations, and discrepancies discovered during testing and code audits.

### Technical Reference

* [Test Suite Checklist Level 1](../test/docs/checklist-level-1.md):
  Module integration test scenarios.
* [Test Suite Checklist Level 2](../test/docs/checklist-level-2.md):
  Subsystem integration test scenarios.
* [Test Suite Checklist Level 3](../test/docs/checklist-level-3.md):
  End-to-End CLI test scenarios.
* [Test Suite Checklist Level 4](../test/docs/checklist-level-4.md):
  End-to-End lifecycle test scenarios.
* [Help Text Checklist](../test/docs/help-text-checklist.md):
  Systematic review of CLI help text.

---

**QA Dashboard** -- Current (automatically generated)

<!--qa-dashboard-start-->
| Test Code | Test Target         | Checklist | # it.skip() | Audit Log      | Test File Path                                         |
|-----------|---------------------|-----------|-------------|---------------|--------------------------------------------------------|
| 4.1.3    | Custom Plugin Workflow| OPEN     |            |              |                                                       |
| 4.1.4    | Local Plugin Update & Sync| OPEN     |            |              |                                                       |
| 4.2.1    | convert --watch     | OPEN     |            |              |                                                       |
| 4.2.2    | convert --watch     | OPEN     |            |              |                                                       |
<!--qa-dashboard-end-->
---

<details>
<summary><b>Original</b> (at script creation)</summary>

| Test Code | Test Target        | Checklist | # it.skip() | Audit Log  | Test File Path  |
|----------|---------------------|----------|------------|--------------|-----------------|
| 1.1.2    |                     |          |            | audit-log:7  |                 |
| 1.2.4    |                     |          |            | audit-log:44 |                 |
| 1.2.8    |                     |          |            | audit-log:44 |                 |
| 1.2.24   | PluginRegistryBuilder | OPEN    | 1 it.skip()| audit-log:56 | test/integration/plugin-registry-builder/plugin-registry-builder.test.1.2.24.js |
| 1.2.27   |                     |          |            | audit-log:68 |                 |
| 1.2.28   |                     |          |            | audit-log:68 |                 |
| 1.2.29   |                     |          |            | audit-log:68 |                 |
| 1.2.30   |                     |          |            | audit-log:68 |                 |
| 1.2.31   |                     |          |            | audit-log:68 |                 |
| 1.2.32   |                     |          |            | audit-log:68 |                 |
| 1.3.2    | plugin_determiner   | OPEN     | 1 it.skip()| audit-log:92 | test/integration/plugin_determiner/plugin_determiner.test.1.3.2.js |
| 1.4.14   | main_config_loader  | OPEN     | 1 it.skip()| audit-log:104| test/integration/main-config-loader/main-config-loader.test.1.4.14.js |
| 1.4.15   | main_config_loader  | OPEN     | 1 it.skip()|              | test/integration/main-config-loader/main-config-loader.test.1.4.15.js |
| 1.6.14   |                     |          |            | audit-log:128|                 |
| 1.7.1    | math_integration    | OPEN     |            |              |                 |
| 1.7.2    | math_integration    | OPEN     |            |              |                 |
| 1.7.3    | math_integration    | OPEN     |            |              |                 |
| 1.7.4    | math_integration    | OPEN     |            |              |                 |
| 1.7.5    | math_integration    | OPEN     |            |              |                 |
| 1.7.6    | math_integration    | OPEN     |            |              |                 |
| 1.7.7    | math_integration    | OPEN     |            |              |                 |
| 1.7.8    | math_integration    | OPEN     |            |              |                 |
| 2.2.2    |                     |          | 1 it.skip()|              | test/integration/default-handler/default-handler.test.2.2.2.js |
| 2.3.9    |                     |          |            | audit-log:178|                 |
| 4.1.1    | CLI Commands Interaction| OPEN |            |              |                 |
| 4.1.2    | CLI Commands Interaction| OPEN |            |              |                 |
| 4.2.1    | convert --watch     | OPEN     |            |              |                 |
| 4.2.2    | convert --watch     | OPEN     |            |              |                 |
| 4.3.1    | collection update   | OPEN     |            |              |                 |
| 4.3.2    | plugin create --from| OPEN     |            |              |                 |

</details>

---

## Uncategorized Test Scripts
<!-- uncategorized-start -->
- [refactor-checklist.md](docs/refactor-checklist.md)
<!-- uncategorized-end -->
