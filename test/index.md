## Test Harness and QA Dashboard

This directory contains all assets related to testing the `md-to-pdf` application, including integration tests, end-to-end (E2E) tests, smoke tests, tests on lints, and the scripts that power this QA dashboard.

### Testing Paradigm -- Manifest/Factory Harness

- **Manifest-Driven:** \
  Test scenarios are declaratively defined in manifest files (e.g., `*.manifest.js`), auditable, and easily extensible coverage.

- **Factory Pattern:** \
  The test runner dynamically instantiates test cases from these manifests, applying stubs/mocks and assertions in a standardized way.

- **Single Source of Truth:** \
  Reduced duplication between "atomic" and "harness" test means every logical scenario is mapped in exactly one place.

### Testing Levels & Coverage Strategy

Tests are organized by increasing scope and integration complexity:

- **Level 0** (Meta): Discrete validation units--linters, parsers, and rule-based checks
- **Level 1**: Module integration scenarios  
- **Level 2**: Subsystem integration scenarios
- **Level 3**: End-to-end CLI scenarios
- **Level 4**: Full lifecycle workflows

Traditional unit tests are intentionally minimal. CLI applications derive more value from integration-level testing, as meaningful behavior occurs at module boundaries, file system operations, and cross-system coordination rather than isolated function calls.

### Testing Framework

The project uses [Mocha](https://mochajs.org/) as its test runner. A centralized configuration file, [`.mocharc.js`](../.mocharc.js), defines test groups and paths, making the suite highly flexible and easier to manage.

#### Running Tests

Tests can be executed in a variety of ways to target specific groups, levels, or specific test files.

  * **Run all tests:**
    ```bash
    npm test
    ```
  * **Run a specific group** (defined in [`.mocharc.js`](../.mocharc.js)):
    ```bash
    npm test -- --group level3
    ```
  * **Run a specific test file** by `grep`ping for its test ID:
    ```bash
    npm test -- --grep "3.5.1"
    ```
  * **Run a single test file** by path:
    ```bash
    npm test -- 'test/e2e/plugin-create.test.js'
    ```

### Telemetry -- Test Watcher

**[ [`test-watcher.js`](scripts/test-watcher.js) ]**

A simple telemetry system watches `src/` for changes and auto-runs corresponding integration tests.
This an **experimental** feature.

```bash
node test/scripts/test-watcher.js
```

### QA System Overview

Test status is dynamically generated by scripts that analyze manifests, checklists, and audit logs.

**Source of Truth**

* `test/docs/checklist-level-?.md`: master list of all planned test scenarios for each level of testing.
* `test/docs/audit-log.md`: documented known issues, limitations, or reasons for skips.

**QA Scripts**

The scripts in `test/scripts/` are used to parse supporting documents and manifests. They generate a consolidated report on any tests that are not in a "completed and passing" state. 


The table below is updated by the **[ [`qa-dashboard.js`](scripts/qa-dashboard.js)** script.

```bash
node test/scripts/qa-dashboard.js --update-index
```

**Checking for Holes in Test Coverage [beyond CI]**

These items are the kinds that *do not* get picked up by a CI. These tests are of three categories, and each category has its own script

- [ [`find-nonclosed-audits.js`](scripts/find-nonclosed-audits.js) ]
  -- tests that are in the [audit log](docs/audit-log.md) not marked as `CLOSED`
- [ [`find-unchecked-tests.js`](scripts/find-unchecked-tests.js) ]
  -- tests that are unchecked in the [checklist](docs/) `checklist-level-?.md`
- [ [`find-skipped-tests.js`](scripts/find-skipped-tests.js) ]
  -- tests that have been skipped via `it.skip()` in test manifests

The **[ [`qa-dashboard.js`](scripts/qa-dashboard.js)** script synthesizes this information into a table at the end of this document.

**Reporter and Logging of Failed Tests**

- [ [`log-failures-reporter.js`](scripts/log-failures-reporter.js) ]
   -- custom mocha **reporter** logging failures to `~/.cache/md-to-pdf/logs/test-failures.json`
- [ [`run-last-fails.js`](scripts/run-last-fails.js) ]
   -- parses `~/.cache/md-to-pdf/logs/test-failures.json` for failed tests to re-run only those tests:
   ```bash
   npm run test:last-fails
   ```

---

## Testing & Quality Assurance

*Documentation that details the project's testing framework, strategy, and metrics that define project quality.*

### Strategy & Process

* [Test Suite Index](../test/index.md):
  Main entry point for test-related documentation (this page).
* [Test Generation Priority Order](../test/docs/test-generation-priority-order.md):
  Explains the ranked, multi-level testing strategy and the module priority.
* [Audit Log](../test/docs/audit-log.md):
  Known issues, limitations, and discrepancies.

### Technical Reference

* [Test Suite Checklist Level 1](../test/docs/checklist-level-1.md):
  Module integration scenarios.
* [Test Suite Checklist Level 2](../test/docs/checklist-level-2.md):
  Subsystem integration scenarios.
* [Test Suite Checklist Level 3](../test/docs/checklist-level-3.md):
  End-to-End CLI scenarios.
* [Test Suite Checklist Level 4](../test/docs/checklist-level-4.md):
  End-to-End lifecycle scenarios.
* [Test Suite Checklist Meta Level 0](../test/docs/checklist-level-m0.md):
  Unit tests for code and documentation linters.

### Evolution of the Test Suite

* [**Test Suite Refactor Impact Report**](../test/docs/refactor-impact.md).

---

**QA Dashboard** -- Current (automatically generated)

<!--qa-dashboard-start-->

| Test Code | Test Target         | Checklist | # it.skip() | Audit Log      | Test File Path                                         |
|-----------|---------------------|-----------|-------------|---------------|--------------------------------------------------------|
| 4.1.3    | Custom Plugin Workflow| OPEN     |            |              |                                                       |
| 4.1.4    | Local Plugin Update & Sync| OPEN     |            |              |                                                       |
| 4.2.1    | convert --watch     | OPEN     |            |              |                                                       |
| 4.2.2    | convert --watch     | OPEN     |            |              |                                                       |

<!--qa-dashboard-end-->

---

<details>
<summary><b>Original</b> (at script creation)</summary>

| Test Code | Test Target        | Checklist | # it.skip() | Audit Log  | Test File Path  |
|----------|---------------------|----------|------------|--------------|-----------------|
| 1.1.2    |                     |          |            | audit-log:7  |                 |
| 1.2.4    |                     |          |            | audit-log:44 |                 |
| 1.2.8    |                     |          |            | audit-log:44 |                 |
| 1.2.24   | plugin-registry-builder | OPEN    | 1 it.skip()| audit-log:56 | test/integration/plugin-registry-builder/plugin-registry-builder.test.1.2.24.js |
| 1.2.27   |                     |          |            | audit-log:68 |                 |
| 1.2.28   |                     |          |            | audit-log:68 |                 |
| 1.2.29   |                     |          |            | audit-log:68 |                 |
| 1.2.30   |                     |          |            | audit-log:68 |                 |
| 1.2.31   |                     |          |            | audit-log:68 |                 |
| 1.2.32   |                     |          |            | audit-log:68 |                 |
| 1.3.2    | plugin-determiner   | OPEN     | 1 it.skip()| audit-log:92 | test/integration/plugin-determiner/plugin-determiner.test.1.3.2.js |
| 1.4.14   | main-config-loader  | OPEN     | 1 it.skip()| audit-log:104| test/integration/main-config-loader/main-config-loader.test.1.4.14.js |
| 1.4.15   | main-config-loader  | OPEN     | 1 it.skip()|              | test/integration/main-config-loader/main-config-loader.test.1.4.15.js |
| 1.6.14   |                     |          |            | audit-log:128|                 |
| 1.7.1    | math-integration    | OPEN     |            |              |                 |
| 1.7.2    | math-integration    | OPEN     |            |              |                 |
| 1.7.3    | math-integration    | OPEN     |            |              |                 |
| 1.7.4    | math-integration    | OPEN     |            |              |                 |
| 1.7.5    | math-integration    | OPEN     |            |              |                 |
| 1.7.6    | math-integration    | OPEN     |            |              |                 |
| 1.7.7    | math-integration    | OPEN     |            |              |                 |
| 1.7.8    | math-integration    | OPEN     |            |              |                 |
| 2.2.2    |                     |          | 1 it.skip()|              | test/integration/default-handler/default-handler.test.2.2.2.js |
| 2.3.9    |                     |          |            | audit-log:178|                 |
| 4.1.1    | CLI Commands Interaction| OPEN |            |              |                 |
| 4.1.2    | CLI Commands Interaction| OPEN |            |              |                 |
| 4.2.1    | convert --watch     | OPEN     |            |              |                 |
| 4.2.2    | convert --watch     | OPEN     |            |              |                 |
| 4.3.1    | collection update   | OPEN     |            |              |                 |
| 4.3.2    | plugin create --from| OPEN     |            |              |                 |

</details>

---

## Uncategorized Test Scripts
<!-- uncategorized-start -->
<!-- uncategorized-end -->
