# Changelog - md-to-pdf v0.8.x Series

* For the v0.7.x changelog, see [changelog-v0.7.md](changelog-v0.7.md).
* For the development track *before* v0.7.0, see [roadmap.md](roadmap.md).

---


## v0.8.3 (Conceptual - CLI Integration Phase 1: Collection & Core Plugin State Commands + Test Integration)

**Date:** 2025-05-31

### Added

* **Unified CLI - `collection` Subcommands:**
    * Integrated `CollectionsManager` functionalities into `md-to-pdf`.
    * New `md-to-pdf collection <subcommand>` group added:
        * `md-to-pdf collection add <url_or_path> [--name <collection_name>]`: Adds a new plugin collection.
        * `md-to-pdf collection list`: Lists all downloaded plugin collection names.
        * `md-to-pdf collection remove <collection_name> [--force]`: Removes a downloaded collection, with `--force` to disable its plugins first.
        * `md-to-pdf collection update [<collection_name>]`: Updates Git-based collections. If no name, updates all. Includes enhanced support for re-syncing locally-sourced collections from their original path.
* **Unified CLI - `plugin enable/disable` Subcommands:**
    * New subcommands added to the existing `md-to-pdf plugin` group:
        * `md-to-pdf plugin enable <collection_name/plugin_id | collection_name --all> [--name <invoke_name>] [--prefix <prefix_string>] [--no-prefix]`: Enables plugin(s) from a managed collection, updating `enabled.yaml`.
        * `md-to-pdf plugin disable <invoke_name>`: Disables an active plugin, updating `enabled.yaml`.
* The `CollectionsManager` instance is now created by the main `md-to-pdf` CLI and made available to these new command handlers via middleware.
* These integrated commands leverage the existing logic and console output behavior of the `CollectionsManager` module.

### Changed

* The main `cli.js` and its command modules in `src/commands/` were updated to support the new `collection` command group and the new `plugin` subcommands (`enable`, `disable`).
* Refined the `success` status reporting for `CollectionsManager.updateAllCollections` to return `false` if any individual collection update fails or is aborted (e.g., due to local changes), ensuring consistency in test assertions.

### Testing

* **Hybrid Testing Strategy for CollectionsManager:**
    * The original `CollectionsManager` test suites (which test methods directly) have been successfully integrated into the main project's test runner (`dev/test/run-tests.js`) under a new category: `cm-module`.
    * These tests are located in `dev/test/cm-tests/` and use adapted helpers (`dev/test/cm-tests/cm-test-helpers.js`) to ensure proper isolation and environment setup (e.g., `MD_TO_PDF_COLL_ROOT_TEST_OVERRIDE`, Git configuration).
    * This approach allows for fast and precise testing of the `CollectionsManager`'s core logic.
    * A `README.md` has been added to `dev/test/cm-tests/` explaining this hybrid strategy and the rationale.
* **CLI-Based Integration Tests (Future Work):**
    * The creation of a comprehensive suite of CLI-based integration tests (using `runCliCommand` for every CM scenario) for the new `md-to-pdf collection ...` and `md-to-pdf plugin enable/disable` commands has been deferred.
    * A select few representative CLI-based tests will be added in a future version (e.g., v0.9.x) to verify end-to-end functionality, rather than exhaustively replicating all `CollectionsManager` module tests at the CLI level. This decision was made due to the complexity and potential brittleness of asserting against detailed console output from multiple software layers.


## v0.8.2 (Conceptual - Main CLI Refactor)

**Date:** 2025-05-30

### Changed

* **Main CLI Refactor (`cli.js`):**
    * The main `md-to-pdf/cli.js` file has been refactored to improve modularity and maintainability, similar to the structure of the `CollectionsManager` module.
    * A new directory `src/commands/` has been created.
    * The yargs command definitions and handler initializations for each top-level command (`config`, `plugin`, `convert`, `generate`, and the default `$0` command) have been moved into separate modules within `src/commands/`.
        * `plugin` subcommands (`list`, `create`, `help`) are further modularized into `src/commands/plugin/`.
    * `cli.js` now imports these command modules and registers them with yargs, acting as an orchestrator.
    * Core execution logic functions (e.g., `executeConversion`, `executeGeneration`, `commonCommandHandler`, `openPdf`) remain in `cli.js` to be accessible by the command handlers.
    * This internal structural change does not alter the CLI's external behavior or functionality. All commands and options remain the same for the user.


## v0.8.1 (Conceptual - Integrate CollectionsManager Manifest)

**Date:** May 30, 2025

### Added
* **CollectionsManager Integration**: `PluginRegistryBuilder.js` now reads the `enabled.yaml` manifest file generated by `md-to-pdf-cm`.
    * Plugins enabled via `md-to-pdf-cm enable ...` are automatically discovered and made available to `md-to-pdf`.
    * This streamlines the workflow, as users no longer need to manually register CM-enabled plugins in a main `config.yaml` file.

### Changed
* **Plugin Registration Precedence**: The order of precedence for plugin registration sources has been updated to include plugins from the CollectionsManager manifest. The new order (highest to lowest) is:
    1.  Project `config.yaml` (`plugins:` section)
    2.  XDG `config.yaml` (`plugins:` section)
    3.  CollectionsManager `enabled.yaml` manifest
    4.  Bundled `config.example.yaml` (`plugins:` section - factory defaults)
* The `md-to-pdf plugin list` command now correctly displays plugins loaded from the CollectionsManager manifest, respecting this precedence.

### Note on Testing
* Direct unit tests for the `enabled.yaml` integration within the main `md-to-pdf` test suite (Task 3.4 from `docs-devel/proposal-v0.8.1.md`) have been deferred.

* **Reason for Deferral**

  Implementing isolated and reliable test cases for this specific integration presents challenges within the current main project's testing framework, particularly concerning the mocking or management of the `enabled.yaml` file and its XDG-based location from within `dev/test/run-tests.js`. The functionality has been manually verified. Future enhancements to the test environment will aim to address this for more comprehensive automated testing of this cross-module interaction.


## v0.8.0 (Conceptual - Main Test Suite Refactor)

**Date:** 2025-05-30

### Changed

* **Test Suite Refactoring (`test/run-tests.js`):**
    * Refactored the main test orchestrator (`test/run-tests.js`) to improve modularity and maintainability.
    * Moved common test utility functions into a new `test/test-helpers.js` file.
    * Centralized shared constants used by tests into a new `test/test-constants.js` file.
    * Organized individual test case definitions into categorized files within a new `test/test-cases/` directory. Categories include `config-command`, `convert-command`, `generate-command`, `plugin-create-command`, and `advanced-features`.
    * The main `test/run-tests.js` now imports test cases from these categorized files and acts as a lean orchestrator.
* **Test Runner CLI Enhancements:**
    * The test runner (`test/run-tests.js`) now accepts command-line arguments to selectively run specific test categories (e.g., `node test/run-tests.js config convert`).
    * Added a help interface to the test runner (e.g., `node test/run-tests.js help`) that lists available test categories and usage instructions for selective execution.
* All 26 existing tests were successfully migrated to the new structure and continue to pass.

